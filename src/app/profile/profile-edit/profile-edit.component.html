<div class="edit-container">
  <!-- Loading State -->
  <div *ngIf="isLoading" class="loading-container">
    <div class="spinner"></div>
    <p>Loading profile...</p>
  </div>

  <!-- Error State - Show prominently if profile fails to load -->
  <div *ngIf="error && !isLoading && !profile" class="error-container">
    <div class="error-message">
      <i class="fas fa-exclamation-circle"></i>
      <p>{{ error }}</p>
      <button class="btn btn-primary" (click)="loadProfile()">Try Again</button>
    </div>
  </div>

  <!-- Edit Form -->
  <div *ngIf="!isLoading && profile" class="edit-content">
    <div class="page-header">
      <h1><i class="fas fa-user-edit"></i> Edit Profile</h1>
      <p class="subtitle">Update your profile information</p>
    </div>

    <!-- Success Message -->
    <div *ngIf="successMessage" class="alert alert-success">
      <i class="fas fa-check-circle"></i>
      {{ successMessage }}
    </div>

    <!-- Error Message -->
    <div *ngIf="error" class="alert alert-error">
      <i class="fas fa-exclamation-circle"></i>
      {{ error }}
    </div>

    <form [formGroup]="profileForm" (ngSubmit)="onSubmit()" class="profile-form">
      <!-- Profile Picture Section -->
      <div class="form-section">
        <h2>Profile Picture</h2>
        <div class="picture-upload">
          <div class="current-picture">
            <img
              [src]="previewUrl || profile.profilePicture || 'https://via.placeholder.com/150'"
              alt="Profile picture"
            />
          </div>
          <div class="upload-controls">
            <input
              type="file"
              #fileInput
              (change)="onFileSelected($event)"
              accept="image/*"
              style="display: none"
            />
            <button type="button" class="btn btn-secondary" (click)="fileInput.click()">
              <i class="fas fa-upload"></i> Choose Photo
            </button>
            <button
              *ngIf="selectedFile"
              type="button"
              class="btn btn-primary"
              (click)="uploadProfilePicture()"
              [disabled]="isSaving"
            >
              <i class="fas fa-save"></i> Upload Photo
            </button>
            <p class="help-text">Recommended: Square image, at least 400x400px</p>
          </div>
        </div>
      </div>

      <!-- Basic Information -->
      <div class="form-section">
        <h2>Basic Information</h2>
        <div class="form-grid">
          <div class="form-group">
            <label for="firstName">First Name *</label>
            <input
              type="text"
              id="firstName"
              formControlName="firstName"
              [class.invalid]="isFieldInvalid('firstName')"
            />
            <span *ngIf="isFieldInvalid('firstName')" class="error-message">
              {{ getErrorMessage('firstName') }}
            </span>
          </div>

          <div class="form-group">
            <label for="lastName">Last Name *</label>
            <input
              type="text"
              id="lastName"
              formControlName="lastName"
              [class.invalid]="isFieldInvalid('lastName')"
            />
            <span *ngIf="isFieldInvalid('lastName')" class="error-message">
              {{ getErrorMessage('lastName') }}
            </span>
          </div>

          <div class="form-group">
            <label for="email">Email</label>
            <input
              type="email"
              id="email"
              formControlName="email"
              [disabled]="true"
            />
            <span class="help-text">Email cannot be changed</span>
          </div>

          <div class="form-group">
            <label for="phone">Phone Number</label>
            <input
              type="tel"
              id="phone"
              formControlName="phone"
              placeholder="+1 (555) 123-4567"
            />
          </div>

          <div class="form-group full-width">
            <label for="location">Location</label>
            <input
              type="text"
              id="location"
              formControlName="location"
              placeholder="City, State/Country"
            />
          </div>
        </div>
      </div>

      <!-- Freelancer Specific Fields -->
      <ng-container *ngIf="isFreelancer()">
        <div class="form-section">
          <h2>Professional Information</h2>
          <div class="form-grid">
            <div class="form-group">
              <label for="title">Professional Title</label>
              <input
                type="text"
                id="title"
                formControlName="title"
                placeholder="e.g., Full Stack Developer"
              />
            </div>

            <div class="form-group">
              <label for="hourlyRate">Hourly Rate (USD)</label>
              <input
                type="number"
                id="hourlyRate"
                formControlName="hourlyRate"
                min="0"
                placeholder="75"
              />
            </div>

            <div class="form-group full-width">
              <label for="availability">Availability</label>
              <select id="availability" formControlName="availability">
                <option *ngFor="let option of availabilityOptions" [value]="option.value">
                  {{ option.label }}
                </option>
              </select>
            </div>

            <div class="form-group full-width">
              <label for="skills">Skills</label>
              <input
                type="text"
                id="skills"
                formControlName="skills"
                placeholder="Angular, TypeScript, Node.js, Python (comma separated)"
              />
              <span class="help-text">Separate skills with commas</span>
            </div>

            <div class="form-group full-width">
              <label for="experience">Experience</label>
              <textarea
                id="experience"
                formControlName="experience"
                rows="3"
                placeholder="Describe your professional experience"
              ></textarea>
            </div>

            <div class="form-group full-width">
              <label for="education">Education</label>
              <textarea
                id="education"
                formControlName="education"
                rows="2"
                placeholder="Your educational background"
              ></textarea>
            </div>
          </div>
        </div>

        <!-- Languages Section -->
        <div class="form-section">
          <h2>Languages</h2>
          <div formArrayName="languages" class="languages-section">
            <div *ngFor="let language of languages.controls; let i = index" [formGroupName]="i" class="language-item">
              <div class="form-grid">
                <div class="form-group">
                  <label [for]="'languageName' + i">Language</label>
                  <input
                    type="text"
                    [id]="'languageName' + i"
                    formControlName="name"
                    placeholder="e.g., English"
                  />
                </div>
                <div class="form-group">
                  <label [for]="'languageProficiency' + i">Proficiency</label>
                  <select [id]="'languageProficiency' + i" formControlName="proficiency">
                    <option *ngFor="let option of proficiencyOptions" [value]="option.value">
                      {{ option.label }}
                    </option>
                  </select>
                </div>
              </div>
              <button type="button" class="btn btn-danger btn-sm" (click)="removeLanguage(i)">
                <i class="fas fa-trash"></i> Remove
              </button>
            </div>
            <button type="button" class="btn btn-secondary" (click)="addLanguage()">
              <i class="fas fa-plus"></i> Add Language
            </button>
          </div>
        </div>
      </ng-container>

      <!-- Customer Specific Fields -->
      <ng-container *ngIf="isCustomer()">
        <div class="form-section">
          <h2>Company Information</h2>
          <div class="form-grid">
            <div class="form-group">
              <label for="company">Company Name</label>
              <input
                type="text"
                id="company"
                formControlName="company"
                placeholder="Your company name"
              />
            </div>

            <div class="form-group">
              <label for="companySize">Company Size</label>
              <select id="companySize" formControlName="companySize">
                <option value="">Select size</option>
                <option value="1-10 employees">1-10 employees</option>
                <option value="11-50 employees">11-50 employees</option>
                <option value="51-200 employees">51-200 employees</option>
                <option value="201-500 employees">201-500 employees</option>
                <option value="500+ employees">500+ employees</option>
              </select>
            </div>

            <div class="form-group">
              <label for="industry">Industry</label>
              <input
                type="text"
                id="industry"
                formControlName="industry"
                placeholder="e.g., Technology, Finance"
              />
            </div>

            <div class="form-group">
              <label for="website">Company Website</label>
              <input
                type="url"
                id="website"
                formControlName="website"
                placeholder="https://example.com"
              />
            </div>
          </div>
        </div>
      </ng-container>

      <!-- Bio Section -->
      <div class="form-section">
        <h2>About Me</h2>
        <div class="form-group">
          <label for="bio">Bio</label>
          <textarea
            id="bio"
            formControlName="bio"
            rows="6"
            placeholder="Tell us about yourself, your expertise, and what makes you unique..."
            maxlength="1000"
          ></textarea>
          <span class="help-text">{{ profileForm.get('bio')?.value?.length || 0 }} / 1000 characters</span>
        </div>
      </div>

      <!-- Social Links -->
      <div class="form-section" formGroupName="socialLinks">
        <h2>Social Links</h2>
        <div class="form-grid">
          <div class="form-group">
            <label for="linkedin"><i class="fab fa-linkedin"></i> LinkedIn</label>
            <input
              type="url"
              id="linkedin"
              formControlName="linkedin"
              placeholder="https://linkedin.com/in/yourprofile"
            />
          </div>

          <div class="form-group" *ngIf="isFreelancer()">
            <label for="github"><i class="fab fa-github"></i> GitHub</label>
            <input
              type="url"
              id="github"
              formControlName="github"
              placeholder="https://github.com/yourusername"
            />
          </div>

          <div class="form-group">
            <label for="twitter"><i class="fab fa-twitter"></i> Twitter</label>
            <input
              type="url"
              id="twitter"
              formControlName="twitter"
              placeholder="https://twitter.com/yourusername"
            />
          </div>

          <div class="form-group">
            <label for="websiteLink"><i class="fas fa-globe"></i> Website</label>
            <input
              type="url"
              id="websiteLink"
              formControlName="website"
              placeholder="https://yourwebsite.com"
            />
          </div>

          <div class="form-group" *ngIf="isFreelancer()">
            <label for="behance"><i class="fab fa-behance"></i> Behance</label>
            <input
              type="url"
              id="behance"
              formControlName="behance"
              placeholder="https://behance.net/yourprofile"
            />
          </div>

          <div class="form-group" *ngIf="isFreelancer()">
            <label for="dribbble"><i class="fab fa-dribbble"></i> Dribbble</label>
            <input
              type="url"
              id="dribbble"
              formControlName="dribbble"
              placeholder="https://dribbble.com/yourusername"
            />
          </div>
        </div>
      </div>

      <!-- Action Buttons -->
      <div class="form-actions">
        <button type="button" class="btn btn-secondary" (click)="cancel()" [disabled]="isSaving">
          Cancel
        </button>
        <button type="submit" class="btn btn-primary" [disabled]="isSaving || profileForm.invalid">
          <i class="fas fa-save"></i>
          {{ isSaving ? 'Saving...' : 'Save Changes' }}
        </button>
      </div>
    </form>
  </div>
</div>
